@page
@using Microsoft.AspNetCore.Mvc.TagHelpers
@using Sfa.Tl.Find.Provider.Application.Extensions
@using Sfa.Tl.Find.Provider.Application.Models
@model Sfa.Tl.Find.Provider.Web.Pages.EmployerInterest.IndexModel
@{
    ViewData["Title"] = "Employer Interest";
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        <h1 class="govuk-heading-l">@ViewData["Title"]</h1>

        <form novalidate method="POST">
            <div>
                <h3>Postcodes</h3>
                <ul>
                    @foreach (var location in Model.ProviderLocations ?? Enumerable.Empty<LocationPostcode>())
                    {
                        <li>@location.Postcode</li>
                    }
                </ul>

                <div class="govuk-form-group">
                    <label class="govuk-label">
                        Postcode
                    </label>
                    <span class="govuk-error-message"></span>
                    <input class="govuk-input govuk-input--width-20" asp-for="Postcode" id="tl-postcode" type="text">
                </div>
            </div>

            <div>
                <p class="govuk-body">Search radius: @Model.SearchRadius</p>
            </div>

            <button type="submit" class="govuk-button" id="tl-search">Search</button>
        </form>

        <table class="govuk-table">
            <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th class="govuk-table__header" scope="col">Organisation</th>
                    <th class="govuk-table__header" scope="col">Industry</th>
                    <th class="govuk-table__header" scope="col">Skill Areas</th>
                    <th class="govuk-table__header" scope="col">Distance</th>
                    <th class="govuk-table__header" scope="col">Data available until</th>
                </tr>
            </thead>
            <tbody class="govuk-table__body">
                @if (Model.EmployerInterestList != null && Model.EmployerInterestList.Any())
                {
                    foreach (var employerInterest in Model.EmployerInterestList)
                    {
                        var availableUntil = employerInterest.CreatedOn.AddDays(Model.EmployerInterestRetentionDays);

                        <tr class="govuk-table__row">
                            <th class="govuk-table__header" scope="row">@employerInterest.OrganisationName</th>
                            <td class="govuk-table__cell">@employerInterest.Industry</td>
                            <td class="govuk-table__cell">
                                @if (employerInterest.SkillAreas is not null && employerInterest.SkillAreas.Any())
                                {
                                    <ul>
                                        @foreach (var skillArea in employerInterest.SkillAreas)
                                        {
                                            <li>@skillArea</li>
                                        }
                                    </ul>
                                }
                            </td>
                            <td class="govuk-table__cell">@employerInterest.Distance.FormatDistance()</td>
                            <td class="govuk-table__cell">
                                @($"{availableUntil:d MMM yyyy}")
                            </td>
                            <td class="govuk-table__cell">
                                <a asp-page="/EmployerDetails" asp-route-id="@employerInterest.Id" class="govuk-link" id="tl-change-link">View</a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
        <div>
            <p class="govuk-body">Total available items: @Model.TotalEmployerInterestItems</p>
            <p class="govuk-body">Service start date: @Model.ServiceStartDate?.ToString("d MMM yyyy")</p>
            <p class="govuk-body">Data will be retained for @Model.EmployerInterestRetentionWeeks weeks</p>
        </div>
    </div>
</div>